discovery.kubernetes "self" {
  role = "pod"
}

kubernetes.metadata "self" {
  targets = discovery.kubernetes.self.targets
}

loki.source.file "app_logs" {
  path_targets = [
    {
      __path__ = "/logs/*.log"
    }
  ]
  forward_to = [kubernetes.metadata.self.receiver]
}

loki.write "default" {
  endpoint {
    url = "http://loki.loki.svc.cluster.local:3100/loki/api/v1/push"
  }
}
