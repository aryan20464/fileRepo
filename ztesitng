apiVersion: v1
kind: ConfigMap
metadata:
  name: alloy-config
  namespace: uatcmm
data:
  config.alloy: |
    [server]
      http_listen_port = 9080

    [discovery.static.static_target]
      targets = ["localhost"]
      [discovery.static.static_target.labels]
        job = "springboot-app"
        pod_name = "${POD_NAME}"

    [local.file_match.logs]
      path_targets = ["localhost"]
      paths = ["/logs/*.log"]

    [log.process.multiline]
      forward_to = ["log.forward.default.receiver"]

      [[log.process.multiline.stage]]
        multiline = { firstline_pattern = "^\\S" }

    [log.forward.default]
      inputs = ["local.file_match.logs.output"]
