discovery.kubernetes "pods" {
  role = "pod"
}

kubernetes.attributes "add_metadata" {
  pod_name     = "${HOSTNAME}"
  node         = "YOUR_NODE_NAME" # optional, can be left out if not needed
  namespace    = "uatcmm"
  tenant_id    = ""
  discovery    = discovery.kubernetes.pods
}

local.file_match "app_logs" {
  path_targets = [{
    path = "/logs/app.log"
  }]
  forward_to = [kubernetes.attributes.add_metadata.receiver]
}

loki.source.file "app_logs" {
  forward_to = [loki.write.default.receiver]
}

loki.write "default" {
  endpoint {
    url = "http://loki.loki.svc.cluster.local:3100/loki/api/v1/push"
  }
}
