{
  "dashboard": {
    "id": null,
    "title": "Linux System Monitoring",
    "timezone": "browser",
    "panels": [
      {
        "type": "graph",
        "title": "Network Receive Bytes/sec",
        "datasource": "prometheus",
        "targets": [
          { "expr": "rate(node_network_receive_bytes_total[1m])", "refId": "A" }
        ],
        "gridPos": { "x": 0, "y": 0, "w": 12, "h": 6 }
      },
      {
        "type": "graph",
        "title": "Network Transmit Bytes/sec",
        "datasource": "prometheus",
        "targets": [
          { "expr": "rate(node_network_transmit_bytes_total[1m])", "refId": "A" }
        ],
        "gridPos": { "x": 12, "y": 0, "w": 12, "h": 6 }
      },
      {
        "type": "stat",
        "title": "CPU Usage (%)",
        "datasource": "prometheus",
        "targets": [
          { "expr": "100 - (avg by (instance) (rate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)", "refId": "A" }
        ],
        "gridPos": { "x": 0, "y": 6, "w": 6, "h": 4 }
      },
      {
        "type": "stat",
        "title": "Memory Used (GiB)",
        "datasource": "prometheus",
        "targets": [
          { "expr": "(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / (1024*1024*1024)", "refId": "A" }
        ],
        "gridPos": { "x": 6, "y": 6, "w": 6, "h": 4 }
      },
      {
        "type": "stat",
        "title": "Swap Used (GiB)",
        "datasource": "prometheus",
        "targets": [
          { "expr": "(node_memory_SwapTotal_bytes - node_memory_SwapFree_bytes) / (1024*1024*1024)", "refId": "A" }
        ],
        "gridPos": { "x": 12, "y": 6, "w": 6, "h": 4 }
      },
      {
        "type": "stat",
        "title": "Running Processes",
        "datasource": "prometheus",
        "targets": [
          { "expr": "node_procs_running", "refId": "A" }
        ],
        "gridPos": { "x": 18, "y": 6, "w": 6, "h": 4 }
      },
      {
        "type": "stat",
        "title": "Blocked Processes",
        "datasource": "prometheus",
        "targets": [
          { "expr": "node_procs_blocked", "refId": "A" }
        ],
        "gridPos": { "x": 0, "y": 10, "w": 6, "h": 4 }
      },
      {
        "type": "stat",
        "title": "System Uptime (s)",
        "datasource": "prometheus",
        "targets": [
          { "expr": "node_time_seconds - node_boot_time_seconds", "refId": "A" }
        ],
        "gridPos": { "x": 6, "y": 10, "w": 6, "h": 4 }
      },
      {
        "type": "graph",
        "title": "Network Errors In/Out",
        "datasource": "prometheus",
        "targets": [
          { "expr": "rate(node_network_receive_errs_total[1m])", "refId": "A" },
          { "expr": "rate(node_network_transmit_errs_total[1m])", "refId": "B" }
        ],
        "gridPos": { "x": 0, "y": 14, "w": 12, "h": 6 }
      },
      {
        "type": "graph",
        "title": "Load Average",
        "datasource": "prometheus",
        "targets": [
          { "expr": "node_load1", "refId": "A" },
          { "expr": "node_load5", "refId": "B" },
          { "expr": "node_load15", "refId": "C" }
        ],
        "gridPos": { "x": 12, "y": 14, "w": 12, "h": 6 }
      },
      {
        "type": "table",
        "title": "Disk Space Per Mount Point",
        "datasource": "prometheus",
        "targets": [
          {
            "expr": "node_filesystem_size_bytes{fstype!=\"rootfs\"}",
            "refId": "A",
            "format": "table"
          },
          {
            "expr": "node_filesystem_free_bytes{fstype!=\"rootfs\"}",
            "refId": "B",
            "format": "table"
          },
          {
            "expr": "node_filesystem_size_bytes{fstype!=\"rootfs\"} - node_filesystem_free_bytes{fstype!=\"rootfs\"}",
            "refId": "C",
            "format": "table"
          }
        ],
        "transformations": [
          {
            "id": "organize",
            "options": {
              "excludeByName": {},
              "indexByName": {},
              "renameByName": {},
              "selectByName": {}
            }
          }
        ],
        "gridPos": { "x": 0, "y": 20, "w": 24, "h": 8 }
      },
      {
        "type": "graph",
        "title": "Disk Read/Write Bytes/sec",
        "datasource": "prometheus",
        "targets": [
          { "expr": "rate(node_disk_read_bytes_total[1m])", "refId": "A" },
          { "expr": "rate(node_disk_written_bytes_total[1m])", "refId": "B" }
        ],
        "gridPos": { "x": 0, "y": 28, "w": 24, "h": 6 }
      }
    ],
    "schemaVersion": 36,
    "version": 2,
    "refresh": "5s"
  },
  "overwrite": true
}





local.file_match "app_logs" {
  path_targets = [{ "__path__" = "/logs/*.log" }]
}

loki.source.file "app_logs" {
  targets    = local.file_match.app_logs.targets
  forward_to = [loki.process.add_app_labels.receiver]
}

loki.process "add_app_labels" {
  stage.static_labels {
    values = {
      service_name = "Starter"
      pod_name     = "linux-host"  # Replace or set via env("HOSTNAME") if needed
    }
  }
  forward_to = [loki.write.default.receiver]
}

loki.write "default" {
  endpoint {
    url = "http://localhost:3100/loki/api/v1/push"
  }
}


server {
    listen 80;
    server_name yourdomain.com;

    location /grafana/ {
        proxy_pass         http://localhost:3000/;
        proxy_set_header   Host $host;
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto $scheme;
        rewrite ^/grafana/(.*) /$1 break;
    }
}


[server]
root_url = http://192.168.1.100/grafana/
serve_from_sub_path = true


auth_enabled: false

server:
  http_listen_port: 3100
  log_level: info

ingester:
  lifecycler:
    ring:
      kvstore:
        store: inmemory
      replication_factor: 1
  final_sleep: 0s
  chunk_idle_period: 5m
  max_chunk_age: 1h

schema_config:
  configs:
    - from: 2024-01-01
      store: boltdb-shipper
      object_store: filesystem
      schema: v13
      index:
        prefix: index_
        period: 24h

storage_config:
  boltdb_shipper:
    active_index_directory: /tmp/loki/index
    cache_location: /tmp/loki/boltdb-cache
    shared_store: filesystem
  filesystem:
    directory: /tmp/loki/chunks

limits_config:
  enforce_metric_name: false
  reject_old_samples: true
  reject_old_samples_max_age: 168h

chunk_store_config:
  max_look_back_period: 0s

table_manager:
  retention_deletes_enabled: false
  retention_period: 0s


server "http" {
  listen_address = "0.0.0.0:12345" # Alloy UI/metrics port
  log_level      = "info"
}

local.file_match "app_logs" {
  path_targets = {
    "app" = "/uat/xsys/app.log"
  }
  forward_to = [loki.write.default.receiver]
}

loki.write "default" {
  endpoint {
    url = "http://localhost:3100/loki/api/v1/push"
  }
}
