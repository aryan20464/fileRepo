{
  "annotations": {
    "list": []
  },
  "editable": true,
  "gnetId": null,
  "graphTooltip": 0,
  "id": null,
  "iteration": 1687600000000,
  "links": [],
  "panels": [
    {
      "datasource": "Prometheus",
      "fieldConfig": {
        "defaults": {
          "unit": "none"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 16,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 1,
      "options": {
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "expr": "node_filesystem_size_bytes{fstype=~\"ext4|xfs\",mountpoint!~\"/(boot|run|var/lib/docker|tmpfs|sys|proc|dev)\"}",
          "format": "table",
          "instant": true,
          "interval": "",
          "refId": "A"
        },
        {
          "expr": "node_filesystem_free_bytes{fstype=~\"ext4|xfs\",mountpoint!~\"/(boot|run|var/lib/docker|tmpfs|sys|proc|dev)\"}",
          "format": "table",
          "instant": true,
          "interval": "",
          "refId": "B"
        }
      ],
      "title": "Mount Point Storage Usage (GB & MB)",
      "transformations": [
        {
          "id": "joinByField",
          "options": {
            "byField": "mountpoint"
          }
        },
        {
          "id": "addFieldFromCalculation",
          "options": {
            "alias": "Used (Bytes)",
            "mode": "binary",
            "reducer": "sum",
            "replaceFields": false,
            "sourceFields": ["Value - A", "Value - B"],
            "binary": {
              "left": "Value - A",
              "operator": "-",
              "right": "Value - B"
            }
          }
        },
        {
          "id": "organize",
          "options": {
            "excludeByName": {},
            "indexByName": {},
            "renameByName": {
              "mountpoint": "Mount Point",
              "fstype": "Filesystem",
              "Value - A": "Total (Bytes)",
              "Value - B": "Free (Bytes)",
              "Used (Bytes)": "Used (Bytes)"
            }
          }
        },
        {
          "id": "addFieldFromCalculation",
          "options": {
            "alias": "Total (GB)",
            "mode": "binary",
            "binary": {
              "left": "Total (Bytes)",
              "operator": "/",
              "right": 1073741824
            }
          }
        },
        {
          "id": "addFieldFromCalculation",
          "options": {
            "alias": "Free (GB)",
            "mode": "binary",
            "binary": {
              "left": "Free (Bytes)",
              "operator": "/",
              "right": 1073741824
            }
          }
        },
        {
          "id": "addFieldFromCalculation",
          "options": {
            "alias": "Used (GB)",
            "mode": "binary",
            "binary": {
              "left": "Used (Bytes)",
              "operator": "/",
              "right": 1073741824
            }
          }
        },
        {
          "id": "addFieldFromCalculation",
          "options": {
            "alias": "Total (MB)",
            "mode": "binary",
            "binary": {
              "left": "Total (Bytes)",
              "operator": "/",
              "right": 1048576
            }
          }
        },
        {
          "id": "addFieldFromCalculation",
          "options": {
            "alias": "Free (MB)",
            "mode": "binary",
            "binary": {
              "left": "Free (Bytes)",
              "operator": "/",
              "right": 1048576
            }
          }
        },
        {
          "id": "addFieldFromCalculation",
          "options": {
            "alias": "Used (MB)",
            "mode": "binary",
            "binary": {
              "left": "Used (Bytes)",
              "operator": "/",
              "right": 1048576
            }
          }
        }
      ],
      "type": "table"
    }
  ],
  "schemaVersion": 37,
  "title": "Mount Point Storage Table",
  "uid": "mountpoint-storage",
  "version": 1
}


local.file_match "app_logs" {
  path_targets = [{ "__path__" = "/logs/*.log" }]
}

loki.source.file "app_logs" {
  targets    = local.file_match.app_logs.targets
  forward_to = [loki.process.add_app_labels.receiver]
}

loki.process "add_app_labels" {
  stage.static_labels {
    values = {
      service_name = "Starter"
      pod_name     = "linux-host"  # Replace or set via env("HOSTNAME") if needed
    }
  }
  forward_to = [loki.write.default.receiver]
}

loki.write "default" {
  endpoint {
    url = "http://localhost:3100/loki/api/v1/push"
  }
}


server {
    listen 80;
    server_name yourdomain.com;

    location /grafana/ {
        proxy_pass         http://localhost:3000/;
        proxy_set_header   Host $host;
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto $scheme;
        rewrite ^/grafana/(.*) /$1 break;
    }
}


[server]
root_url = http://192.168.1.100/grafana/
serve_from_sub_path = true


auth_enabled: false

server:
  http_listen_port: 3100
  log_level: info

ingester:
  lifecycler:
    ring:
      kvstore:
        store: inmemory
      replication_factor: 1
  final_sleep: 0s
  chunk_idle_period: 5m
  max_chunk_age: 1h

schema_config:
  configs:
    - from: 2024-01-01
      store: boltdb-shipper
      object_store: filesystem
      schema: v13
      index:
        prefix: index_
        period: 24h

storage_config:
  boltdb_shipper:
    active_index_directory: /tmp/loki/index
    cache_location: /tmp/loki/boltdb-cache
    shared_store: filesystem
  filesystem:
    directory: /tmp/loki/chunks

limits_config:
  enforce_metric_name: false
  reject_old_samples: true
  reject_old_samples_max_age: 168h

chunk_store_config:
  max_look_back_period: 0s

table_manager:
  retention_deletes_enabled: false
  retention_period: 0s


server "http" {
  listen_address = "0.0.0.0:12345" # Alloy UI/metrics port
  log_level      = "info"
}

local.file_match "app_logs" {
  path_targets = {
    "app" = "/uat/xsys/app.log"
  }
  forward_to = [loki.write.default.receiver]
}

loki.write "default" {
  endpoint {
    url = "http://localhost:3100/loki/api/v1/push"
  }
}
